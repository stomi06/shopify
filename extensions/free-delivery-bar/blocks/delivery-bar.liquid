{% comment %}
  Free Delivery Bar Block
  WyÅ›wietla pasek z informacjÄ… o darmowej dostawie
{% endcomment %}

<div class="free-delivery-bar" 
     id="free-delivery-bar"
     data-shop="{{ shop.permanent_domain }}"
     data-threshold="{{ block.settings.min_amount | default: 199 }}"
     style="
       background-color: {{ block.settings.background_color | default: '#4CAF50' }};
       color: {{ block.settings.text_color | default: '#ffffff' }};
       text-align: center;
       padding: 12px 20px;
       font-weight: 600;
       position: relative;
       z-index: 1000;
       {% if block.settings.position == 'bottom' %}
         position: fixed;
         bottom: 0;
         left: 0;
         right: 0;
       {% endif %}
     ">
  
  <span id="delivery-message">
    {% if block.settings.message != blank %}
      {{ block.settings.message }}
    {% else %}
      ğŸšš Darmowa dostawa przy zamÃ³wieniu powyÅ¼ej {{ block.settings.min_amount | default: 199 }} zÅ‚!
    {% endif %}
  </span>
  
  {% if block.settings.closeable %}
    <button onclick="this.parentElement.style.display='none'" 
            style="
              background: none;
              border: none;
              color: inherit;
              float: right;
              cursor: pointer;
              font-size: 18px;
              line-height: 1;
              padding: 0;
              margin-left: 10px;
            ">Ã—</button>
  {% endif %}
</div>

<script>
// Dynamiczna aktualizacja wiadomoÅ›ci na podstawie wartoÅ›ci koszyka
(function() {
  const deliveryBar = document.getElementById('free-delivery-bar');
  if (!deliveryBar) return;
  
  const threshold = parseInt(deliveryBar.getAttribute('data-threshold'));
  
  // Funkcja do aktualizacji wiadomoÅ›ci na podstawie wartoÅ›ci koszyka
  function updateDeliveryMessage() {
    // Pobierz aktualnÄ… wartoÅ›Ä‡ koszyka z Shopify
    fetch('/cart.js')
      .then(response => response.json())
      .then(cart => {
        const cartTotal = cart.total_price / 100; // Shopify zwraca w groszach
        const messageElement = document.getElementById('delivery-message');
        
        if (cartTotal >= threshold) {
          messageElement.innerHTML = 'ğŸ‰ Masz darmowÄ… dostawÄ™!';
          deliveryBar.style.backgroundColor = '#4CAF50';
        } else {
          const remaining = threshold - cartTotal;
          messageElement.innerHTML = `ğŸšš Dodaj za ${remaining.toFixed(2)} zÅ‚ i otrzymasz darmowÄ… dostawÄ™!`;
          deliveryBar.style.backgroundColor = '#FF9800';
        }
      })
      .catch(() => {
        // Fallback - pokaÅ¼ domyÅ›lnÄ… wiadomoÅ›Ä‡
        console.log('Nie moÅ¼na pobraÄ‡ informacji o koszyku');
      });
  }
  
  // Zaktualizuj przy zaÅ‚adowaniu strony
  updateDeliveryMessage();
  
  // NasÅ‚uchuj zmian w koszyku
  document.addEventListener('cart:updated', updateDeliveryMessage);
  
})();
</script>

{% schema %}
{
  "name": "Free Delivery Bar",
  "target": "section",
  "stylesheet": "free-delivery-bar.css",
  "javascript": "free-delivery-bar.js",
  "settings": [
    {
      "type": "text",
      "id": "message",
      "label": "WiadomoÅ›Ä‡",
      "default": "ğŸšš Darmowa dostawa powyÅ¼ej {amount} zÅ‚!",
      "info": "Tekst wyÅ›wietlany na pasku. UÅ¼yj {amount} jako placeholder"
    },
    {
      "type": "number",
      "id": "min_amount",
      "label": "Minimalna kwota (zÅ‚)",
      "default": 199
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Kolor tÅ‚a",
      "default": "#4CAF50"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Kolor tekstu",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "position",
      "label": "Pozycja paska",
      "options": [
        {
          "value": "top",
          "label": "GÃ³ra strony"
        },
        {
          "value": "bottom",
          "label": "DÃ³Å‚ strony (sticky)"
        }
      ],
      "default": "top"
    },
    {
      "type": "checkbox",
      "id": "closeable",
      "label": "MoÅ¼liwoÅ›Ä‡ zamkniÄ™cia",
      "default": true,
      "info": "Pozwala uÅ¼ytkownikowi zamknÄ…Ä‡ pasek"
    }
  ]
}
{% endschema %}
