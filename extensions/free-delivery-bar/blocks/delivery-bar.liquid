{% comment %}
  Free Delivery Bar Block
  WyÅ›wietla pasek z informacjÄ… o darmowej dostawie
{% endcomment %}

<div class="free-delivery-bar" 
     id="free-delivery-bar"
     data-shop="{{ shop.permanent_domain }}"
     style="
       background-color: {{ block.settings.background_color | default: '#4CAF50' }};
       color: {{ block.settings.text_color | default: '#ffffff' }};
       text-align: center;
       padding: 12px 20px;
       font-weight: 600;
       position: relative;
       z-index: 1000;
       {% if block.settings.position == 'bottom' %}
         position: fixed;
         bottom: 0;
         left: 0;
         right: 0;
       {% endif %}
     ">
  
  <span id="delivery-message">
    {% if block.settings.message != blank %}
      {{ block.settings.message }}
    {% else %}
      ðŸšš Darmowa dostawa przy zamÃ³wieniu powyÅ¼ej {{ block.settings.min_amount | default: 199 }} zÅ‚!
    {% endif %}
  </span>
  
  {% if block.settings.closeable %}
    <button onclick="this.parentElement.style.display='none'" 
            style="
              background: none;
              border: none;
              color: inherit;
              float: right;
              cursor: pointer;
              font-size: 18px;
              line-height: 1;
              padding: 0;
              margin-left: 10px;
            ">Ã—</button>
  {% endif %}
</div>

<script>
// ZaÅ‚aduj ustawienia z API i zaktualizuj pasek
(function() {
  const deliveryBar = document.getElementById('free-delivery-bar');
  if (!deliveryBar) return;
  
  const shop = deliveryBar.getAttribute('data-shop');
  
  // Pobierz ustawienia z API
  fetch(`/api/delivery-bar/${shop}`)
    .then(response => response.json())
    .then(settings => {
      // Zaktualizuj wiadomoÅ›Ä‡
      const messageElement = document.getElementById('delivery-message');
      if (messageElement && settings.message) {
        // ZastÄ…p {amount} rzeczywistÄ… wartoÅ›ciÄ…
        const message = settings.message.replace('{amount}', settings.threshold || 199);
        messageElement.textContent = message;
      }
      
      // Zaktualizuj kolory
      if (settings.backgroundColor) {
        deliveryBar.style.backgroundColor = settings.backgroundColor;
      }
      if (settings.textColor) {
        deliveryBar.style.color = settings.textColor;
      }
      
      // Zaktualizuj pozycjÄ™
      if (settings.position === 'bottom') {
        deliveryBar.style.position = 'fixed';
        deliveryBar.style.bottom = '0';
        deliveryBar.style.left = '0';
        deliveryBar.style.right = '0';
      }
    })
    .catch(err => {
      console.log('UÅ¼ywam domyÅ›lnych ustawieÅ„ dla paska dostawy');
    });
})();
</script>

{% schema %}
{
  "name": "Free Delivery Bar",
  "target": "section",
  "stylesheet": "free-delivery-bar.css",
  "javascript": "free-delivery-bar.js",
  "settings": [
    {
      "type": "text",
      "id": "message",
      "label": "WiadomoÅ›Ä‡",
      "default": "ðŸšš Darmowa dostawa powyÅ¼ej 100 zÅ‚!",
      "info": "Tekst wyÅ›wietlany na pasku"
    },
    {
      "type": "number",
      "id": "min_amount",
      "label": "Minimalna kwota (zÅ‚)",
      "default": 100
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Kolor tÅ‚a",
      "default": "#00a651"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Kolor tekstu",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "position",
      "label": "Pozycja paska",
      "options": [
        {
          "value": "top",
          "label": "GÃ³ra strony"
        },
        {
          "value": "bottom",
          "label": "DÃ³Å‚ strony (sticky)"
        }
      ],
      "default": "top"
    },
    {
      "type": "checkbox",
      "id": "closeable",
      "label": "MoÅ¼liwoÅ›Ä‡ zamkniÄ™cia",
      "default": true,
      "info": "Pozwala uÅ¼ytkownikowi zamknÄ…Ä‡ pasek"
    },
    {
      "type": "checkbox",
      "id": "show_on_cart_page",
      "label": "Pokazuj na stronie koszyka",
      "default": false
    }
  ]
}
{% endschema %}
